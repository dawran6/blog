
<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet/less" type="text/css" href="http://localhost:8000/theme/stylesheet/style.less">
    <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/2.5.1/less.min.js" type="text/javascript"></script>

  <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/pygments/monokai.min.css">
  <link rel="stylesheet" type="text/css" href="http://localhost:8000/theme/font-awesome/css/font-awesome.min.css">


    <link href="http://localhost:8000/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Daw-Ran Liou's Blog Atom">


    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/images/favicon.ico" type="image/x-icon">

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />


<meta name="author" content="Daw-Ran Liou" />
<meta name="description" content="Challenge yourself to use awesome language features instead of for-loops" />
<meta name="keywords" content="python, best-practice, tip">
<meta property="og:site_name" content="Daw-Ran Liou's Blog"/>
<meta property="og:title" content="Never Write For-Loops Again"/>
<meta property="og:description" content="Challenge yourself to use awesome language features instead of for-loops"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://localhost:8000/never-write-for-loops.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2016-11-17 00:00:00-08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="http://localhost:8000/author/daw-ran-liou.html">
<meta property="article:section" content="Python"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="best-practice"/>
<meta property="article:tag" content="tip"/>
<meta property="og:image" content="http://localhost:8000/http://critical-thinkers.com/wp-content/uploads/2015/01/shutterstock_208347706.jpg">

  <title>Daw-Ran Liou's Blog &ndash; Never Write For-Loops Again</title>

</head>
<body>
  <aside>
    <div>
      <a href="http://localhost:8000">
        <img src="//en.gravatar.com/userimage/99964636/f9367cffe912e77fa93af6784d93b99e.jpg?size=120" alt="Daw-Ran Liou" title="Daw-Ran Liou">
      </a>
      <h1><a href="http://localhost:8000">Daw-Ran Liou</a></h1>

<p>Software Developer - Maker</p>

      <ul class="social">
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/randyliou" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-twitter" href="https://twitter.com/dawranliou" target="_blank"><i class="fa fa-twitter"></i></a></li>
        <li><a class="sc-github" href="https://github.com/dawran6" target="_blank"><i class="fa fa-github"></i></a></li>
        <li><a class="sc-medium" href="https://medium.com/@dawran6" target="_blank"><i class="fa fa-medium"></i></a></li>
        <li><a class="sc-rss" href="//dawranliou.com/feeds/all.atom.xml" target="_blank"><i class="fa fa-rss"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>

    <nav>
      <a href="http://localhost:8000">    Home
</a>

      <a href="/archives.html">Archives</a>
      <a href="/categories.html">Categories</a>
      <a href="/tags.html">Tags</a>

      <a href="http://localhost:8000/feeds/all.atom.xml">    Atom
</a>

    </nav>

<article class="single">
  <header>
    <h1 id="never-write-for-loops">Never Write For-Loops Again</h1>
    <p>
          Posted on Thu 17 November 2016 in <a href="http://localhost:8000/category/python.html">Python</a>


        &#8226; 4 min read
    </p>
  </header>


  <div>
    <p>This is a challenge. I challenge you to avoid writing for-loops in every scenario.
Also, I challenge you to find the scenarios that are so freaking hard to write 
anything else but a for-loop. Please share your findings. I’d like to hear about
them.</p>
<p>It’s been a while since I started exploring the amazing language features in 
Python. At the beginning, it’s just a challenge I gave myself to practice using 
more language features instead of those I learned from other programming 
language. And things are just getting more fun! Not only the code become shorter
and cleaner, but also code looks more structured and disciplined. I’ll get into 
those benefits more in this article.</p>
<p>But first, let’s take a step back and see what’s the intuition behind writing a 
for-loop:</p>
<ol>
<li>To go through a sequence to extract out some information</li>
<li>To generate another sequence out of the current sequence</li>
<li>This is my second nature to write for-loops because I’m a programmer</li>
</ol>
<p>Fortunately, there are already great tools that are built into Python to help 
you accomplish the goals! All you need is to shift your mind and look at the 
things in a different angle.</p>
<h1>What you gain by not writing for-loops everywhere</h1>
<ol>
<li>Fewer lines of code</li>
<li>Better code readability</li>
<li>Leave indentation for managing context only</li>
</ol>
<p>Let’s see the code skeleton below:</p>
<div class="highlight"><pre><span></span><span class="c1"># 1</span>
<span class="k">with</span> <span class="o">...</span><span class="p">:</span>
    <span class="k">for</span> <span class="o">...</span><span class="p">:</span>
        <span class="k">if</span> <span class="o">...</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
            <span class="k">except</span><span class="p">:</span>
        <span class="k">else</span><span class="p">:</span>
</pre></div>


<p>In this example, we are dealing with multiple layers of code. THIS IS HARD TO 
READ. The problem I found in this code is that it is mixing the 
<strong>administrative</strong> logic (the <code>with</code>, <code>try-except</code>) with the <strong>business logic</strong> 
(the <code>for</code>, <code>if</code>) by giving them the indentation ubiquitously. If you are 
disciplined about using indentation only for administrative logic, your core 
business logic would stand out immediately.</p>
<blockquote>
<p>"Flat is better than nested" - The Zen of Python</p>
</blockquote>
<h1>Tools you can use to avoid using for-loops</h1>
<h2>1. List Comprehension / Generator Expression</h2>
<p>Let’s see a simple example. Basically you want to compile a sequence based on 
another existing sequence:</p>
<div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">:</span>
    <span class="n">new_item</span> <span class="o">=</span> <span class="n">do_something_with</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</pre></div>


<p>You can use <code>map</code> if you love MapReduce, or, Python has List Comprehension:</p>
<div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="p">[</span><span class="n">do_something_with</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">]</span>
</pre></div>


<p>Similarly, if you wish to get a iterator only, you can use Generator Expression 
with almost the same syntax. (How can you not love the consistency in Python?)</p>
<div class="highlight"><pre><span></span><span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="n">do_something_with</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">)</span>
</pre></div>


<h2>2. Functions</h2>
<p>Thinking in a higher-order, more functional programming way, if you want to map 
a sequence to another, simply call the <code>map</code> function. (Be my guest to use list 
comprehension here instead.)</p>
<div class="highlight"><pre><span></span><span class="n">doubled_list</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">old_list</span><span class="p">)</span>
</pre></div>


<p>If you want to reduce a sequence into a single, use <code>reduce</code></p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="nb">reduce</span>
<span class="n">summation</span> <span class="o">=</span> <span class="nb">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="n">numbers</span><span class="p">)</span>
</pre></div>


<p>Also, lots of Python's builtin functions consumes iterables:</p>
<div class="highlight"><pre><span></span><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">all</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="bp">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">any</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="mi">9</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="mi">0</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">set</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">a</span><span class="p">))</span>
<span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">:</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">:</span> <span class="mi">9</span><span class="p">}</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="s1">&#39;[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">sum</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="mi">45</span>
</pre></div>


<h2>3. Extract Functions or Generators</h2>
<p>The above two methods are great to deal with simpler logic. How about more 
complex logic? As a programmer, we write functions to abstract out the difficult
things. Same idea applies here. If you are writing this:</p>
<div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">:</span>
    <span class="c1"># setups</span>
    <span class="c1"># condition</span>
    <span class="c1"># processing</span>
    <span class="c1"># calculation</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</pre></div>


<p>Apparently you are giving too much responsibility to a single code block. 
Instead, I propose you do:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process_item</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="c1"># setups</span>
    <span class="c1"># condition</span>
    <span class="c1"># processing</span>
    <span class="c1"># calculation</span>
    <span class="k">return</span> <span class="n">result</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">process_item</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">item_list</span><span class="p">]</span>
</pre></div>


<p>How about nested for-loops?</p>
<div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
        <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>
</pre></div>


<p>List Comprehension got your back:</p>
<div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
           <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
           <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
</pre></div>


<p>How about if you have some internal state in the code block to
keep?</p>
<div class="highlight"><pre><span></span><span class="c1"># finding the max prior to the current item</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">current_max</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
    <span class="n">current_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">current_max</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_max</span><span class="p">)</span>

<span class="c1"># results = [3, 4, 6, 6, 6, 9, 9, 9, 9, 9]</span>
</pre></div>


<p>Let's extract a generator to achieve this:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">max_generator</span><span class="p">(</span><span class="n">numbers</span><span class="p">):</span>
    <span class="n">current_max</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
        <span class="n">current_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">current_max</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">current_max</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="n">results</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">max_generator</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</pre></div>


<blockquote>
<p>"Oh wait, you just used a for-loop in the generator function. That's cheating!"</p>
</blockquote>
<p>Fine, smart ass, let's try the following.</p>
<h2>4. Don't write it yourself. <code>itertools</code> got you covered</h2>
<p>This module is simply brilliant. I believe this module covers 80% of the cases 
that you makes you want to write for-loops. For example, the last example can be
rewritten to:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">accumulate</span>
<span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
<span class="n">resutls</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">accumulate</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">max</span><span class="p">))</span>
</pre></div>


<p>Also, if you are iterating on combinatoric sequnces, there are <code>product()</code>, 
<code>permutations()</code>, <code>combinations()</code> to use.</p>
<h1>Conclusion</h1>
<ol>
<li>You don’t need to write for-loops in most scenarios</li>
<li>You should avoid writing for-loops, so you have better code readability</li>
</ol>
<h1>Action</h1>
<ol>
<li>Look at your code again. Spot any places that you wrote a for-loop previously
by intuition. Think again and see if it make sense to re-write it without using 
for-loop.</li>
<li>Share your cases that are hard to code without using for-loops</li>
</ol>
<p><em>This <a href="https://medium.com/@dawran6/never-write-for-loops-again-91a5a4c84baf">article</a> was originally posted in my <a href="https://medium.com/@dawran6">Medium blog</a></em></p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="http://localhost:8000/tag/python.html">python</a>
      <a href="http://localhost:8000/tag/best-practice.html">best-practice</a>
      <a href="http://localhost:8000/tag/tip.html">tip</a>
    </p>
  </div>




</article>

    <footer>
<p>
  &copy; Daw-Ran Liou 2016 - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
         src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Daw-Ran Liou's Blog ",
  "url" : "http://localhost:8000",
  "image": "//en.gravatar.com/userimage/99964636/f9367cffe912e77fa93af6784d93b99e.jpg?size=120",
  "description": "Daw-Ran Liou's Thoughts and Writings"
}
</script>
</body>
</html>